<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<div xmlns:field="urn:jsptagdir:/WEB-INF/tags/form/fields"
     xmlns:spring="http://www.springframework.org/tags"
     xmlns:util="urn:jsptagdir:/WEB-INF/tags/util"
     xmlns:form="http://www.springframework.org/tags/form"
     version="2.0">

    <spring:eval expression="@tamaProperties['application.version']" var="applicationVersion"/>

    <spring:url value="/resources-${applicationVersion}/js/reports.js" var="reports_js"/>
    <spring:url value="/resources-${applicationVersion}/dojox/grid/resources/Grid.css" var="grid_css"/>
    <spring:url value="/resources-${applicationVersion}/styles/reports.css" var="reports_css"/>
    <spring:url value="/resources-${applicationVersion}/images/spinner.gif" var="spinner_gif"/>

    <script src="${reports_js}" type="text/javascript"><!-- required--></script>
    <link rel="stylesheet" type="text/css" media="screen" href="${grid_css}"></link>
    <link rel="stylesheet" type="text/css" media="screen" href="${reports_css}"></link>

    <div>
        <util:panel id="outboxMessageReport" title="Outbox Message Report" openPane="true">
            <div>
                <label for="startDate"> Start Date *</label>
                <input type="text" name="startDate" id="outboxMessageReportStartDate"/>
                <script type="text/javascript">
                    Spring.addDecoration(new Spring.ElementDecoration({elementId : 'outboxMessageReportStartDate', widgetType : 'dijit.form.DateTextBox', widgetAttrs : {promptMessage: 'Please enter start date',  required: 'true', constraints: {datePattern : 'dd/MM/yyyy', required : 'true'}, datePattern : 'dd/MM/yyyy'}}));
                </script>
            </div>
            <div>
                <label for="endDate"> End Date *</label>
                <input type="text" name="endDate" id="outboxMessageReportEndDate"/>
                <script type="text/javascript">
                    Spring.addDecoration(new Spring.ElementDecoration({elementId : 'outboxMessageReportEndDate', widgetType : 'dijit.form.DateTextBox', widgetAttrs : {promptMessage: 'Please enter end date',  required: 'true', constraints: {datePattern : 'dd/MM/yyyy', required : 'true'}, datePattern : 'dd/MM/yyyy'}}));
                </script>
            </div>
            <div class="submit" id="outboxMessageReportSubmitDiv">
                <spring:message code="button_save" var="save_button" htmlEscape="false" />
                <input id="getOutboxMessageReport" type="submit" value="Generate Report"/>
                <span id="getOutboxMessageReportSpinner"><img src="${spinner_gif}"/></span>
            </div>

            <div id="outboxMessageReportGridNotice"><!-- required or JSP eats me --></div>
            <div id="outboxMessageReportGrid">
                <a id="outboxMessageReportGridExcelLink" href="#">Download as Excel</a>
                <div id="outboxMessageReportGridPlaceholder" style="margin-top: 10px;"></div>
            </div>
        </util:panel>
    </div>

    <script type="text/javascript">
        <![CDATA[
            dojo.addOnLoad(function() {
                var dailyPillReminderReportWidget = new tama.OutboxMessagesReportWidget("outboxMessageReportGrid", "reports/outboxMessageReport.json");
                var spinnerBanner = new Banner("getOutboxMessageReportSpinner");
                outboxStartDateObj = dijit.byId("outboxMessageReportStartDate");
                outboxEndDateObj = dijit.byId("outboxMessageReportEndDate");
                spinnerBanner.hide();
                dojo.connect(dojo.byId("getOutboxMessageReport"), "onclick", function(event){
                    Spring.decorations['outboxMessageReportStartDate'][0].validate();
                    Spring.decorations['outboxMessageReportEndDate'][0].validate();

                    if (outboxStartDateObj.isValid() && outboxEndDateObj.isValid()){
                        spinnerBanner.show();
                        var onCreateHandler = function(){ spinnerBanner.hide(); }
                        dailyPillReminderReportWidget.create(outboxStartDateObj.value, outboxEndDateObj.value, onCreateHandler);
                    }
                });

                dojo.connect(outboxStartDateObj, "onChange", function() {
                    setConstraintOnEndDate(outboxStartDateObj, outboxEndDateObj);
                });
            });
        ]]>
    </script>

</div>
